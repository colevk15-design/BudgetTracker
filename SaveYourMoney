<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget & Spending Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
  body { font-family: 'Poppins', sans-serif; background: #f4f6f8; color: #333; display:flex; flex-direction:column; align-items:center; padding:20px; transition: background 0.3s,color 0.3s;}
  body.dark { background:#1e1e2f; color:#f0f0f0;}
  header { width:100%; max-width:950px; display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px;}
  h1 { margin:0; color:#2c3e50;}
  body.dark h1 { color:#f0f0f0;}
  select, button { padding:6px 10px; margin-left:5px; border-radius:5px; border:1px solid #ccc; font-family:inherit; background:white; font-size:1em; cursor:pointer; transition: background 0.3s,color 0.3s;}
  body.dark select, body.dark button { background:#333; color:#f0f0f0; border:1px solid #555;}
  button:hover { background:#f0f0f0;}
  body.dark button:hover { background:#444;}
  .charts { display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-start; gap:20px; margin-bottom:25px;}
  .chart-container { background:white; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; width:300px; height:240px; transition: background 0.3s,color 0.3s;}
  body.dark .chart-container { background:#2a2a3d; color:#f0f0f0;}
  canvas { width:100% !important; height:200px !important;}
  table { border-collapse:collapse; width:95%; max-width:950px; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.1); border-radius:6px; overflow:hidden; transition: background 0.3s,color 0.3s;}
  body.dark table { background:#2a2a3d; color:#f0f0f0;}
  th, td { padding:10px 14px; text-align:center; border-bottom:1px solid #eee;}
  body.dark th, body.dark td { border-bottom:1px solid #555;}
  th { background-color:#007bff; color:white;}
  body.dark th { background-color:#0056b3;}
  tfoot td { font-weight:bold; background:#fafafa;}
  body.dark tfoot td { background:#333;}
  input[type="number"], input[type="text"] { width:90%; padding:5px; text-align:center; border:1px solid #ccc; border-radius:4px; background:white; color:#333; transition: background 0.3s,color 0.3s;}
  body.dark input[type="number"], body.dark input[type="text"] { background:#333; color:#f0f0f0; border:1px solid #555;}
  .positive { color:green; font-weight:bold;}
  .negative { color:red; font-weight:bold;}
  .footer { margin-top:20px; font-size:0.9em; color:#777;}
  body.dark .footer { color:#ccc;}
  #addCategory { margin-top:10px;}
  .drag-handle { cursor:grab;}
</style>
</head>
<body>

<header>
  <h1>üí∞ Budget & Spending Tracker</h1>
  <div>
    <label for="currency">Currency: </label>
    <select id="currency" onchange="updateCurrency()">
      <option value="$" selected>$ USD</option>
      <option value="‚Ç¨">‚Ç¨ EUR</option>
      <option value="¬£">¬£ GBP</option>
      <option value="‚Çπ">‚Çπ INR</option>
      <option value="¬•">¬• JPY</option>
      <option value="‚Ç©">‚Ç© KRW</option>
      <option value="‚Ç¶">‚Ç¶ NGN</option>
      <option value="‚Ç±">‚Ç± PHP</option>
      <option value="‚Ç´">‚Ç´ VND</option>
      <option value="R">R ZAR</option>
      <option value="‚Ç¥">‚Ç¥ UAH</option>
      <option value="‡∏ø">‡∏ø THB</option>
      <option value="‚Ç™">‚Ç™ ILS</option>
      <option value="‚Ç≤">‚Ç≤ PYG</option>
      <option value="‚Çµ">‚Çµ GHS</option>
      <option value="‚Ç°">‚Ç° CRC</option>
      <option value="‚Ç∫">‚Ç∫ TRY</option>
      <option value="‚Ç∏">‚Ç∏ KZT</option>
      <option value="‚ÇÆ">‚ÇÆ MNT</option>
      <option value="‚ÇΩ">‚ÇΩ RUB</option>
      <option value="‚Ç®">‚Ç® PKR</option>
      <option value="CHF">CHF</option>
    </select>
    <button onclick="exportCSV()">üì• Export CSV</button>
    <input type="file" id="importFile" accept=".csv" onchange="importCSV(event)">
    <button onclick="toggleDarkMode()">üåô Dark Mode</button>
  </div>
</header>

<div class="charts">
  <div class="chart-container"><canvas id="barChart"></canvas></div>
  <div class="chart-container"><canvas id="pieChart"></canvas></div>
</div>

<table id="budgetTable">
  <thead>
    <tr>
      <th></th>
      <th>Category</th>
      <th id="plannedHeader">Planned Budget ($)</th>
      <th id="actualHeader">Actual Spending ($)</th>
      <th>Difference ($)</th>
      <th>Notes</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody id="budgetBody"></tbody>
  <tfoot>
    <tr>
      <td colspan="2">Total</td>
      <td id="totalPlanned"></td>
      <td id="totalActual"></td>
      <td id="totalDiff"></td>
      <td colspan="2"></td>
    </tr>
  </tfoot>
</table>

<button id="addCategory" onclick="addCategory()">‚ûï Add Category</button>

<div class="footer">Made with ‚ù§Ô∏è ‚Äî saves automatically to your browser.</div>

<script>
let profiles = {};
let currentProfile = "Default";
let categories = ["Rent / Mortgage","Utilities","Groceries","Transportation","Entertainment","Subscriptions","Healthcare","Insurance","Education","Clothing","Dining Out","Savings / Investments","Travel","Pets","Gifts & Donations","Home Maintenance","Miscellaneous"];
let currencySymbol = "$";
const tbody = document.getElementById("budgetBody");

// --- Build Table ---
function buildTable() {
  tbody.innerHTML = "";
  categories.forEach(cat => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="drag-handle">‚ò∞</td>
      <td>${cat}</td>
      <td><input type="number" oninput="saveData(); updateTotals()"></td>
      <td><input type="number" oninput="saveData(); updateTotals()"></td>
      <td class="diff"></td>
      <td><input type="text" placeholder="Notes" oninput="saveData()"></td>
      <td><button onclick="deleteCategory(this)">üóëÔ∏è</button></td>
    `;
    tbody.appendChild(row);
  });
}

// --- Drag & Drop ---
Sortable.create(tbody, { handle: '.drag-handle', animation:150, onEnd:()=>{ categories = Array.from(tbody.querySelectorAll('tr td:nth-child(2)')).map(td=>td.textContent); saveData(); } });

// --- Add/Delete ---
function addCategory() {
  const newCat = prompt("Enter new category name:");
  if(!newCat) return;
  categories.push(newCat);
  buildTable();
  updateTotals();
  saveData();
}

function deleteCategory(btn) {
  const row = btn.parentElement;
  const index = Array.from(tbody.children).indexOf(row);
  categories.splice(index,1);
  buildTable();
  updateTotals();
  saveData();
}

// --- Currency ---
function updateCurrency() {
  currencySymbol = document.getElementById("currency").value;
  document.getElementById("plannedHeader").textContent = `Planned Budget (${currencySymbol})`;
  document.getElementById("actualHeader").textContent = `Actual Spending (${currencySymbol})`;
  saveData();
  updateTotals();
}

// --- Totals & Charts ---
let barChart, pieChart;
function updateTotals() {
  let totalPlanned=0, totalActual=0;
  const labels=[], plannedData=[], actualData=[];
  tbody.querySelectorAll('tr').forEach(row=>{
    const planned = parseFloat(row.cells[2].querySelector('input').value)||0;
    const actual = parseFloat(row.cells[3].querySelector('input').value)||0;
    const diff = planned-actual;
    row.cells[4].textContent = currencySymbol + diff.toFixed(2);
    row.cells[4].className = 'diff '+(diff>=0?'positive':'negative');
    totalPlanned += planned;
    totalActual += actual;
    labels.push(row.cells[1].textContent);
    plannedData.push(planned);
    actualData.push(actual);
  });
  const totalDiff = totalPlanned - totalActual;
  document.getElementById('totalPlanned').textContent = currencySymbol + totalPlanned.toFixed(2);
  document.getElementById('totalActual').textContent = currencySymbol + totalActual.toFixed(2);
  const diffCell = document.getElementById('totalDiff');
  diffCell.textContent = currencySymbol + totalDiff.toFixed(2);
  diffCell.className = totalDiff>=0?'positive':'negative';
  updateCharts(labels, plannedData, actualData);
}

// --- Charts ---
function updateCharts(labels, plannedData, actualData) {
  const ctxBar = document.getElementById('barChart').getContext('2d');
  const ctxPie = document.getElementById('pieChart').getContext('2d');
  if(barChart) barChart.destroy();
  if(pieChart) pieChart.destroy();
  barChart = new Chart(ctxBar,{
    type:'bar',
    data:{labels,datasets:[
      {label:`Planned (${currencySymbol})`, data:plannedData, backgroundColor:'rgba(0,123,255,0.6)'},
      {label:`Actual (${currencySymbol})`, data:actualData, backgroundColor:'rgba(255,99,132,0.6)'}
    ]},
    options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });
  pieChart = new Chart(ctxPie,{
    type:'pie',
    data:{labels,datasets:[{data:actualData, backgroundColor:labels.map((_,i)=>`hsl(${(i*30)%360},70%,60%)`)}]},
    options:{plugins:{legend:{position:'bottom'},tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${currencySymbol}${ctx.parsed.toFixed(2)}`}}}}
  });
}

// --- Dark Mode ---
function toggleDarkMode(){ document.body.classList.toggle('dark'); saveData(); }

// --- Save/Load ---
function saveData() {
  profiles[currentProfile] = {currency:currencySymbol, darkMode:document.body.classList.contains('dark'), categories:[], rows:[]};
  tbody.querySelectorAll('tr').forEach(row=>{
    profiles[currentProfile].categories.push(row.cells[1].textContent);
    profiles[currentProfile].rows.push({
      planned:row.cells[2].querySelector('input').value,
      actual:row.cells[3].querySelector('input').value,
      notes:row.cells[5].querySelector('input').value
    });
  });
  localStorage.setItem('budgetProfiles',JSON.stringify(profiles));
}

function loadData() {
  const saved = JSON.parse(localStorage.getItem('budgetProfiles'));
  if(saved) profiles = saved;
  if(profiles[currentProfile]) {
    const data = profiles[currentProfile];
    currencySymbol = data.currency||"$";
    document.getElementById("currency").value = currencySymbol;
    if(data.darkMode) document.body.classList.add('dark');
    categories = data.categories || categories;
    buildTable();
    data.rows?.forEach((r,i)=>{
      const row = tbody.children[i];
      if(!row) return;
      row.cells[2].querySelector('input').value = r.planned||0;
      row.cells[3].querySelector('input').value = r.actual||0;
      row.cells[5].querySelector('input').value = r.notes||"";
    });
    updateTotals();
  } else {
    buildTable();
    updateTotals();
  }
}

// --- CSV Export/Import ---
function exportCSV(){
  const rows=[["Category",`Planned (${currencySymbol})`,`Actual (${currencySymbol})`,`Difference (${currencySymbol})`,"Notes"]];
  tbody.querySelectorAll('tr').forEach(row=>{
    const category=row.cells[1].textContent;
    const planned=row.cells[2].querySelector('input').value||0;
    const actual=row.cells[3].querySelector('input').value||0;
    const diff=(planned-actual).toFixed(2);
    const notes=row.cells[5].querySelector('input').value.replace(/,/g," ");
    rows.push([category,planned,actual,diff,notes].join(","));
  });
  const totalRow=["Total",document.getElementById('totalPlanned').textContent.replace(currencySymbol,""),document.getElementById('totalActual').textContent.replace(currencySymbol,""),document.getElementById('totalDiff').textContent.replace(currencySymbol,""),""];
  rows.push(totalRow.join(","));
  const blob=new Blob([rows.join("\n")],{type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="budget_data.csv"; link.click();
}

function importCSV(event){
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload=function(e){
    const lines=e.target.result.split(/\r?\n/).filter(l=>l.trim());
    if(lines.length<2) return alert("CSV format incorrect");
    const importedCats = [];
    lines.slice(1).forEach((line,i)=>{
      if(i>=categories.length) return;
      const cols=line.split(",");
      const row=tbody.children[i];
      row.cells[2].querySelector('input').value=parseFloat(cols[1])||0;
      row.cells[3].querySelector('input').value=parseFloat(cols[2])||0;
      row.cells[5].querySelector('input').value=cols[4]||"";
      importedCats.push(cols[0]);
    });
    categories=importedCats;
    buildTable();
    updateTotals();
    saveData();
  };
  reader.readAsText(file);
}

// --- Initialize ---
loadData();
updateTotals();
</script>

</body>
</html>
